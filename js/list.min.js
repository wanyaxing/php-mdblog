$(function(){function t(t,e){var i=$(t).closest(".item_bg"),o=i.closest(".item_li"),n=i.find(".item_body"),a=i.find(".content");if(i.hasClass("item_bg_fixed"))return!1;i.attr("id")||i.attr("id","item_"+(new Date).getTime());var s={id:i.attr("id"),url:i.find(".name").attr("href"),title:i.find(".name").text(),isDetail:1};e&&(window.history.pushState(s,s.title,s.url),$("title").html(s.title)),a.hasClass("content_load")||$.get(s.url+(s.url.indexOf("?")>0?"&":"?")+"is_ajax=1").then(function(t){a.html(t).addClass("content_load"),a.find("pre code").each(function(t,e){hljs.highlightBlock(e)})});var l=i.offset();l.top=l.top-(document.body.scrollTop+document.documentElement.scrollTop),i.data("position",l);var d=document.scrollingElement.scrollTop,r=$("body").width();$("body").addClass("body-prevent-class").data("scrollTop",d).css({top:-d+"px",width:r+"px"}),i.addClass("item_bg_fixed").addClass("item_showing"),n.css({top:l.top+"px",left:l.left+"px",width:o.width()+"px",height:o.height()+"px"}).addClass("anime"),i.find(".description").hide(),i.find(".content").fadeIn();var h=n[0];anime.remove(h),anime({targets:h,scale:1,top:0,left:$("#blog_list").offset().left,width:$("#blog_list").width()+"px",height:[{value:"256px",duration:150},{value:"1000px",duration:350},{value:"100pv",duration:300}],duration:800,complete:function(t){n.css("height","auto"),n.removeClass("anime"),i.removeClass("item_showing"),"undefined"!=typeof _hmt&&_hmt.push(["_trackPageview",window.location.href])}})}function e(){var t=$(".item_bg_fixed");if(!t.hasClass("item_bg_fixed"))return!1;var e=t.closest(".item_li"),i=t.find(".item_body");t.find(".content");t.addClass("item_hiding"),i.addClass("anime"),t.find(".content").hide(),t.find(".description").fadeIn(),t.css({});var o=t.data("position"),n=i[0];anime.remove(n),anime({targets:n,scale:1,top:o.top+"px",left:o.left+"px",width:e.width()+"px",height:e.height()+"px",duration:500,complete:function(e){t.removeClass("item_bg_fixed").removeClass("item_hiding"),i.removeClass("anime"),i.css({top:"",left:"",width:"",height:""}),$("body").removeClass("body-prevent-class").css({top:"",width:""}),document.scrollingElement.scrollTop=$("body").data("scrollTop"),"undefined"!=typeof _hmt&&_hmt.push(["_trackPageview",window.location.href])}})}$("#blog_list").on("click",".btn_loadmore",function(t){var e=$(this);if(e.hasClass("loading"))return!1;e.addClass("loading").html("加载中...");var i=e.attr("href");return $.get(i+(i.indexOf("?")>0?"&":"?")+"is_ajax=1").then(function(t){e.fadeOut(function(){"undefined"!=typeof _hmt&&_hmt.push(["_trackPageview",i]),e.remove(),$("#blog_list").append(t)})}),t.preventDefault(),t.stopPropagation(),!1});var i=(window.history&&window.history.pushState&&window.history.replaceState&&navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),window.location.href,$("title").text(),{id:(new Date).getTime(),url:window.location.href,title:document.title,isDetail:0});window.history.replaceState(i,i.title,i.url),window.onpopstate=function(i){if(i.state&&i.state.id){if(i.state.isDetail){var o=$("#"+i.state.id);o.length>0?t(o,0):window.history.go(0)}else e();i.state.title&&(document.title=i.state.title)}return!1},$("#blog_list").on("click",".description,.name",function(e){return t(this,1),e.preventDefault(),e.stopPropagation(),!1}),$("#blog_list").on("click",".btn_close",function(t){return window.history.go(-1),t.preventDefault(),t.stopPropagation(),!1})});